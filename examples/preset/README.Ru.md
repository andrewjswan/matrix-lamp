# ESPHome Package: Matrix Lamp Preset Manager
## Описание проекта

Этот проект представляет собой пакет (package) для ESPHome, предназначенный для управления пресетами и плейлистами в LED-лампе на базе Neopixel (матрица светодиодов). Пакет позволяет сохранять, загружать и автоматически запускать пользовательские настройки эффектов, яркости, интенсивности, скорости и масштаба для различных сценариев освещения. Он интегрируется в умный дом (например, Home Assistant) и поддерживает автоматизацию по времени, положению солнца и режимам "день/ночь".

Проект разработан для пользователей ESPHome, желающих расширить функциональность своей LED-матрицы (например, на базе ESP32 или аналогичных устройств) без необходимости писать весь код с нуля. Пакет использует глобальные переменные для хранения настроек, что обеспечивает их сохранение при перезагрузке устройства.

## Функции проекта

Этот паккадж расширяет возможности проекта LED matrix projects (e.g., [andrewjswan/matrix-lamp](https://github.com/andrewjswan/matrix-lamp)) 

### 1. **Управление пресетами**
   - **5 индивидуальных пресетов (0-4)**: Каждый пресет хранит настройки эффекта (effect_name), яркости (brightness), интенсивности (intensity), скорости (speed) и масштаба (scale).
   - **Сохранение пресета**: Кнопка "Save Preset" сохраняет текущие параметры светодиода в выбранный пресет.
   - **Загрузка пресета**: Выбор пресета в селекторе автоматически применяет настройки к LED-матрице.

### 2. **Плейлист (Playlist)**
   - **Сочетание пресетов**: Плейлист позволяет объединять несколько пресетов (0-4) с индивидуальными длительностями (в формате MM:SS).
   - **Автоматическое воспроизведение**: Скрипт `play_preset_playlist` последовательно запускает эффекты из плейлиста с задержками.
   - **Включение/исключение пресетов**: Режимы "in playlist" и "out playlist" управляют, какие пресеты входят в плейлист.

### 3. **Режимы старта и автоматизация**
   - **Режимы старта для каждого пресета**:
     - "None": Ручной запуск.
     - "start on time": Запуск по заданному времени (HH:MM).
     - "sunrise": Запуск по восходу солнца с коррекцией угла elevation.
     - "sunset": Запуск по закату солнца с коррекцией угла elevation.
     - "day": Запуск весь день (elevation > 0°).
     - "night": Запуск всю ночь (elevation < 0°).
     - "in playlist": Добавление в плейлист с длительностью.
     - "out playlist": Удаление из плейлиста.
   - **Коррекции для солнца**: Number-элемент для настройки коррекции elevation (в градусах) для sunrise/sunset.
   - **Автоматический запуск**: Интервалы (30 сек и 300 сек) проверяют условия и автоматически запускают пресеты/плейлист.

### 4. **Интерфейс и сенсоры**
   - **Select для выбора пресета**: Опции: "0"-"4", "Playlist", "None".
   - **Select для режима старта**: Список режимов для выбранного пресета.
   - **Datetime picker**: Для установки времени старта или длительности (MM:SS для плейлиста).
   - **Number для коррекции запуска на восходе и закате**: "Sun Elevation Correction" (-90° до +90°).
   - **Text sensors**:
     - "Preset Info": Отображает настройки текущего пресета (эффект, параметры, плейлист).
     - "Preset Start Settings": Показывает режим, время и коррекции.
     - Текущее время (SNTP и Home Assistant).
   - **Сенсоры солнца**: Elevation и azimuth для автоматизации.
   - **Button для сохранения изменений**

### 5. **Дополнительные возможности**
   - **Синхронизация времени**: Через SNTP и Home Assistant.
   - **Глобальные переменные**: Все настройки сохраняются в globals с `restore_value: yes` для persistence.
   - **Логирование**: ESP_LOG для отладки (например, сохранение пресетов).
   - **Интеграция с Home Assistant**: Все элементы (select, number, text_sensor) доступны в UI.

### 6. **Технические детали**
   - **Зависимости**: Требует базовой конфигурации ESPHome с проектом matrix-lamp:  Neopixel LED (`id: neopixel_led`), числами (`matrix_intensity`, `matrix_speed`, `matrix_scale`) 

Этот пакет идеален для создания динамического освещения: например, утренний sunrise-эффект, вечерний sunset, ночной плейлист или дневной режим по расписанию.
